esphome:
  name: esp32-c6-gyro
  friendly_name: Gyro

esp32:
  board: esp32-c6-devkitc-1
  framework:
    type: esp-idf

# Enable logging
logger:

# Enable Home Assistant API
api:
  encryption:
    key: "Your key"

ota:
  - platform: esphome
    password: "Your password"

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  # power_save_mode: none
  fast_connect: true

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: "Esp32-C6-Gyro Fallback Hotspot"
    password: "Your password"

captive_portal:

# Get time
time:
  - platform: sntp
    id: sntp_time
    timezone: Europe/Stockholm
    servers:
     - 0.pool.ntp.org
     - 1.pool.ntp.org
     - 2.pool.ntp.org
    
web_server:
  port: 80
    
i2c:
  sda: GPIO2
  scl: GPIO3
  scan: false
  id: bus_a
    

text_sensor:

  - platform: template
    name: Uptime
    update_interval: 1s
    icon: mdi:clock-start
    lambda: |-
      auto s = millis() / 1000;
      return str_snprintf("%02d:%02d:%02d:%02d", 11, s / 86400, s / 3600 % 24, s / 60 % 60, s % 60);

  - platform: version
    name: ESPHome Version
    hide_timestamp: true
  - platform: wifi_info
    ip_address:
      name: WiFi IP
      icon: mdi:ip-network
    ssid:
      name: WiFi SSID
      icon: mdi:wifi
    mac_address:
      name: "WiFi MAC"
      icon: mdi:identifier
    
sensor:

  - platform: mpu6050
    address: 0x68
    accel_x:
      id: accel_x
      name: "accel X"
      filters:
        - sliding_window_moving_average:
            window_size: 5
            send_every: 1
        
    accel_y:
      id: accel_y    
      name: "accel Y"
      filters:
        - sliding_window_moving_average:
            window_size: 4
            send_every: 1   
        
    accel_z:
      id: accel_z    
      name: "accel Z"
      filters:
        - sliding_window_moving_average:
            window_size: 4
            send_every: 1   
        
    gyro_x:
      name: "gyro X"
      filters:
        - sliding_window_moving_average:
            window_size: 4
            send_every: 1   
        
    gyro_y:
      name: "gyro Y"
      filters:
        - sliding_window_moving_average:
            window_size: 4
            send_every: 1     
        
    gyro_z:
      name: "gyro z"
      filters:
        - sliding_window_moving_average:
            window_size: 4
            send_every: 1      
        
    temperature:
      name: "MPU6050 Temperature"
    update_interval: 5s
    
  - platform: template
    id: roll
    name: pan1roll
    accuracy_decimals: 2
    lambda: |-
      return  (atan( id(accel_y).state / sqrt( pow( id(accel_x).state , 2) + pow( id(accel_z).state , 2) ) ) * 180 / 3.141593) ;
    update_interval: 5s

  - platform: template
    id: pitch
    name: pan1pitch
    accuracy_decimals: 2
    lambda: |-
      return  (atan(-1 * id(accel_x).state / sqrt(pow(id(accel_y).state, 2) + pow(id(accel_z).state, 2))) * 180 / 3.141593);
    update_interval: 5s
      
  # Reports the WiFi signal strength/RSSI in dB
  - platform: wifi_signal 
    name: "WiFi Signal dB"
    id: wifi_signal_db
    update_interval: 60s
    entity_category: "diagnostic"
  
  # Reports the WiFi signal strength in %
  - platform: copy 
    source_id: wifi_signal_db
    name: "WiFi Signal Strength"
    filters:
      - lambda: return min(max(2 * (x + 100.0), 0.0), 100.0);
    unit_of_measurement: " %"
    entity_category: "diagnostic"
    
  # Only on esp32 
  - platform: internal_temperature
    name: "Internal Temperature"
    
  - platform: uptime
    id: uptime_sec

switch:
  - platform: shutdown
    name: "Shutdown unit"

  - platform: restart
    name: "Restart unit"